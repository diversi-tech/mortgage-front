import './polyfills.server.mjs';
import{a as Ue}from"./chunk-RBTBQMIM.mjs";import{X as ze,ba as M,d as Pe,e as $e,m as k,o as Re}from"./chunk-XHNBCMO3.mjs";import{A as Ie,C as Fe,F as xe,Oa as je,Qa as Y,Ra as Be,Y as Ge,Z as Ne,aa as Le,ba as Ve,i as _e,k as he,ka as Oe,m as fe,n as D,o as Ee,p as ge,q as ve,qa as Te,ra as qe,s as W,sa as Ae,ta as ke,u as Se,ua as Me,v as Ce,x as be,y as ye,z as we}from"./chunk-LIEEKJXI.mjs";import{r as A,u as ce,w as Q}from"./chunk-MR55LIO3.mjs";import{Bb as i,Cb as t,Db as q,Hb as P,Kb as f,Mb as $,Rb as R,Sb as z,Tb as U,Vb as u,Wb as C,Wc as pe,Xb as J,Xc as de,Ya as l,Za as g,_ as V,bd as De,ha as O,ia as T,p as le,pa as _,qa as h,qb as c,sb as p}from"./chunk-YZM5RFRX.mjs";import{h as L}from"./chunk-NDYDZJSS.mjs";function Je(){return e=>{let o=new Date(e.value),E=new Date;return o>E?{invalidBirthDate:!0}:o.getFullYear()>E.getFullYear()?{invalidBirthDate:!0}:null}}function Qe(){return e=>{let o=e.value;return o?/^\d{9}$/.test(o)?Array.from(o,Number).reduce((n,s,r)=>{let a=s*(r%2+1);return n+(a>9?a-9:a)},0)%10!==0?{invalidIsraeliId:!0}:null:{invalidIsraeliId:!0}:null}}var b=function(e){return e[e.Single=0]="Single",e[e.Married=1]="Married",e[e.Divorced=2]="Divorced",e[e.Widowed=3]="Widowed",e}(b||{}),j=function(e){return e[e.Employed=0]="Employed",e[e.SelfEmployed=1]="SelfEmployed",e}(j||{}),S=function(e){return e[e.\u05DE\u05D7\u05D9\u05E8_\u05DC\u05DE\u05E9\u05EA\u05DB\u05DF=0]="\u05DE\u05D7\u05D9\u05E8_\u05DC\u05DE\u05E9\u05EA\u05DB\u05DF",e[e.New=1]="New",e[e.Old=2]="Old",e[e.Renovation=3]="Renovation",e[e.Other=4]="Other",e}(S||{}),B=function(e){return e[e.whatup=0]="whatup",e[e.email=1]="email",e}(B||{}),Z=function(e){return e[e.l=0]="l",e[e.c=1]="c",e[e.a=2]="a",e}(Z||{});var Ke=["stepper"];function Xe(e,o){e&1&&u(0,"\u05D4\u05D2\u05D3\u05E8\u05EA \u05E9\u05DD \u05DE\u05E9\u05EA\u05DE\u05E9 \u05D5\u05E1\u05D9\u05E1\u05DE\u05D0")}function et(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function tt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05D0\u05D9\u05DE\u05D9\u05D9\u05DC \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF"),t())}function rt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function it(e,o){if(e&1&&(i(0,"li",43),u(1),t()),e&2){let E=o.$implicit;l(),J(" ",E," ")}}function nt(e,o){if(e&1&&(i(0,"li",44),u(1),t()),e&2){let E=o.$implicit;l(),J(" ",E," ")}}function ot(e,o){if(e&1&&(i(0,"div")(1,"p"),u(2,"\u05D3\u05E8\u05D9\u05E9\u05D5\u05EA \u05DC\u05E1\u05D9\u05E1\u05DE\u05D4 \u05D7\u05D6\u05E7\u05D4:"),t(),i(3,"ul"),c(4,it,2,1,"li",41)(5,nt,2,1,"li",42),t()()),e&2){let E=$();l(4),p("ngForOf",E.passwordStrength.valid),l(),p("ngForOf",E.passwordStrength.invalid)}}function ut(e,o){e&1&&u(0,"\u05E2\u05D3\u05DB\u05D5\u05DF \u05E4\u05E8\u05D8\u05D9\u05DD \u05D0\u05D9\u05E9\u05D9\u05D9\u05DD")}function at(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function st(e,o){e&1&&(i(0,"mat-error"),u(1," \u05D9\u05E9 \u05DC\u05DB\u05EA\u05D5\u05D1 \u05D1\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05E8\u05E7 \u05D0\u05D5\u05EA\u05D9\u05D5\u05EA "),t())}function mt(e,o){if(e&1&&(i(0,"mat-option",45),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function lt(e,o){if(e&1&&(i(0,"mat-option",45),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function pt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function dt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Dt(e,o){if(e&1&&(i(0,"mat-option",45),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function ct(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function _t(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function ht(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function ft(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Et(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E7\u05E6\u05D1\u05D0\u05D5\u05EA \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function gt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05DE\u05D6\u05D5\u05E0\u05D5\u05EA \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function vt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E2\u05D5\u05D3 \u05DE\u05E7\u05D5\u05E8 \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function St(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function Ct(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function bt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function yt(e,o){e&1&&u(0,"\u05E4\u05E8\u05D8\u05D9 \u05D4\u05E0\u05DB\u05E1")}function wt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function It(e,o){if(e&1){let E=P();i(0,"mat-option",46),f("click",function(){let s=_(E).$implicit,r=$();return h(r.saveSelectionType(s.value))}),u(1),t()}if(e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function Ft(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function xt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Gt(e,o){if(e&1&&(i(0,"mat-option",45),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function Nt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Lt(e,o){e&1&&u(0,"\u05D4\u05E2\u05DC\u05D0\u05EA \u05DE\u05E1\u05DE\u05DB\u05D9\u05DD")}var K=(()=>{let o=class o{constructor(n,s,r,a,d,m,y,w){this.loginservice=n,this.route=s,this._formBuilder=r,this.customerService=a,this.leadService=d,this.userService=m,this.documentType=y,this.customerTask=w,this.user={id:0,userName:"",password:"",email:"",role:Y.Customer,created_at:new Date(Date.now()),updated_at:new Date(Date.now())},this.currentStepIndex=0,this.isCustomer=!1,this.isLead=!1,this.isLinear=!0,this.isAddDocuments=!1,this.res="",this.lead_id=null,this.uploadedFiles=[],this.showTable=!1,this.tableData=[],this.document={id:0,customer_Id:0,task_description:"",document_type_id:0,document_path:"",status:0,status2:0,due_date:new Date(Date.now()),created_at:new Date(Date.now()),updated_at:new Date(Date.now()),isOk:!1,id2:0},this.customerData={id:0,lead_id:this.lead_id,last_Name:"",first_Name:"",email:"",phone:"",connection:0,t_z:"",birthDate:new Date(Date.now()),family_status:0,number_of_people_in_house:0,address:"",job_status:0,customer_type:0,work_business_name:"",job_description:"",avarage_monthly_salary:0,years_in_current_position:0,income_rent:0,income_Government_Endorsement:0,income_other:0,expenses_rent:0,expenses_loans:0,expenses_other:0,property_city:"",transaction_type:0,estimated_price_by_customer:0,estimated_price_by_sales_agreement:0,has_other_properties:!1,amount_of_loan_requested:0,lastSynced:new Date(Date.now()),isArchived:!1,created_at:new Date(Date.now()),updated_at:new Date(Date.now()),userId:0},this.familyStatusOptions=[{value:b.Single,label:"\u05E8\u05D5\u05D5\u05E7"},{value:b.Married,label:"\u05E0\u05E9\u05D5\u05D9"},{value:b.Divorced,label:"\u05D2\u05E8\u05D5\u05E9"},{value:b.Widowed,label:"\u05D0\u05DC\u05DE\u05DF"}],this.jobStatusOptions=[{value:j.Employed,label:"\u05E9\u05DB\u05D9\u05E8"},{value:j.SelfEmployed,label:"\u05E2\u05E6\u05DE\u05D0\u05D9"}],this.transactiontypeOptions=[{value:S.\u05DE\u05D7\u05D9\u05E8_\u05DC\u05DE\u05E9\u05EA\u05DB\u05DF,label:"\u05DE\u05D7\u05D9\u05E8 \u05DC\u05DE\u05E9\u05EA\u05DB\u05DF"},{value:S.New,label:"\u05D9\u05D3 \u05E8\u05D0\u05E9\u05D5\u05E0\u05D4"},{value:S.Old,label:"\u05D9\u05D3 \u05E9\u05E0\u05D9\u05D4"},{value:S.Renovation,label:"\u05E9\u05D9\u05E4\u05D5\u05E6\u05D9\u05DD"},{value:S.Other,label:"\u05DC\u05DB\u05DC \u05DE\u05D8\u05E8\u05D4"}],this.connectionOptions=[{value:B.whatup,label:"\u05D5\u05D5\u05D0\u05E6\u05D0\u05E4"},{value:B.email,label:"\u05DE\u05D9\u05D9\u05DC"}],this.hasOtherProperties=[{value:!0,label:"\u05DB\u05DF"},{value:!1,label:"\u05DC\u05D0"}],this.passwordStrength={valid:[],invalid:[]},this.passwordStrengthValidator=I=>{let v=I.value,F=/[A-Z]/.test(v),x=/[a-z]/.test(v),G=/[0-9]/.test(v),N=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(v);return this.passwordStrength.valid=[],this.passwordStrength.invalid=[],v.length>=10?this.passwordStrength.valid.push("\u05D0\u05D5\u05E8\u05DA 10 \u05EA\u05D5\u05D5\u05D9\u05DD \u05DC\u05E4\u05D7\u05D5\u05EA"):this.passwordStrength.invalid.push("\u05D0\u05D5\u05E8\u05DA 10 \u05EA\u05D5\u05D5\u05D9\u05DD \u05DC\u05E4\u05D7\u05D5\u05EA"),F?this.passwordStrength.valid.push("\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D4"):this.passwordStrength.invalid.push("\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D4"),x?this.passwordStrength.valid.push("\u05D0\u05D5\u05EA \u05E7\u05D8\u05E0\u05D4"):this.passwordStrength.invalid.push("\u05D0\u05D5\u05EA \u05E7\u05D8\u05E0\u05D4"),G?this.passwordStrength.valid.push("\u05DE\u05E1\u05E4\u05E8"):this.passwordStrength.invalid.push("\u05DE\u05E1\u05E4\u05E8"),N?this.passwordStrength.valid.push("\u05EA\u05D5 \u05DE\u05D9\u05D5\u05D7\u05D3"):this.passwordStrength.invalid.push("\u05EA\u05D5 \u05DE\u05D9\u05D5\u05D7\u05D3"),this.passwordStrength.invalid.length===0?null:{passwordStrength:!0}},this.firstFormGroup=new ve({userName:new W({value:"",disabled:!1},[D.required,D.email]),password:new W({value:"",disabled:!1},[D.required,D.minLength(10),this.passwordStrengthValidator])}),this.secondFormGroup=this._formBuilder.group({last_Name:["",[D.pattern("^[a-zA-Z\u05D0-\u05EA ]*$"),D.required]],first_Name:[""],email:[""],phone:[""],connection:[""],t_z:["",[D.required,Qe()]],birthDate:["",[D.required,Je()]],family_status:["",D.required],number_of_people_in_house:["",[D.pattern("^[0-9]*$"),D.required]],address:["",D.required],job_status:[""],customer_type:[""],work_business_name:["",D.required],job_description:["",D.required],avarage_monthly_salary:["",[D.pattern("^[0-9]*$"),D.required]],years_in_current_position:["",[D.pattern("^[0-9]*$"),D.required]],income_rent:["",[D.pattern("^[0-9]*$"),D.required]],income_Government_Endorsement:["",[D.pattern("^[0-9]*$"),D.required]],income_other:["",[D.pattern("^[0-9]*$"),D.required]],expenses_rent:["",[D.pattern("^[0-9]*$"),D.required]],expenses_loans:["",[D.pattern("^[0-9]*$"),D.required]],expenses_other:["",D.required]}),this.thirdFormGroup=this._formBuilder.group({property_city:["",D.required],transaction_type:["",D.required],estimated_price_by_customer:["",D.required],estimated_price_by_sales_agreement:["",D.required],has_other_properties:["",D.required],amount_of_loan_requested:["",D.required],userId:[""]}),this.fourthFormGroup=this._formBuilder.group({documents:["",D.required]})}ngOnInit(){console.log("in ngOnInit of lead"),this.route.paramMap.subscribe(d=>{this.lead_id=Number(d.get("id"))}),localStorage.getItem("enterOrNot")===null&&localStorage.setItem("enterOrNot","false");let n=localStorage.getItem("userName"),s=localStorage.getItem("password");n!==null&&s!==null&&(this.firstFormGroup.setValue({userName:JSON.parse(n),password:JSON.parse(s)}),this.firstFormGroup.get("userName")?.disable(),this.firstFormGroup.get("password")?.disable());let r=localStorage.getItem("currentStep");r!==null&&(this.currentStepIndex=parseInt(r,10));let a=localStorage.getItem("tableData");a&&(this.tableData=JSON.parse(a)),this.loadFormData()}loadCustomerDataFromLocalStorage(){let n=localStorage.getItem("customerData");n&&(this.customerData=JSON.parse(n))}onStepChange(n){this.currentStepIndex=n.selectedIndex,localStorage.setItem("currentStep",this.currentStepIndex.toString())}ngAfterViewInit(){this.loadCurrentStep()}isReturningUser(){return localStorage.getItem("enterOrNot")==="true"}checkUserNameAndPassword(){this.leadService.getLeadById(this.lead_id).subscribe(n=>{n&&(this.customerData.phone=n.phone,this.customerData.email=n.email,this.customerData.first_Name=n.first_Name)}),this.user.id=0,this.user.userName=this.firstFormGroup.value.userName,this.user.password=this.firstFormGroup.value.password,this.user.email=this.firstFormGroup.value.userName,this.user.role=Y.Customer,this.user.created_at=new Date(Date.now()),this.user.updated_at=new Date(Date.now()),this.userService.IsExist(this.user).subscribe(n=>{localStorage.setItem("userName",JSON.stringify(this.user.userName)),localStorage.setItem("password",JSON.stringify(this.user.password)),this.res=n,n==="200"?localStorage.getItem("enterOrNot")==="true"?this.stepper.next():alert("\u05D0\u05D9\u05D9\u05DE\u05D9\u05DC \u05D0\u05D5 \u05E1\u05D9\u05E1\u05DE\u05D0 \u05EA\u05E4\u05D5\u05E1\u05D9\u05DD \u05E0\u05D0 \u05DC\u05D4\u05DB\u05E0\u05D9\u05E1 \u05D0\u05D7\u05E8"):n==="404"&&this.user!==null&&this.user!==void 0&&this.user.password!==""&&this.user.userName!==""?(localStorage.setItem("enterOrNot","true"),this.stepper.next(),this.userService.createUserForLead(this.user,this.lead_id).subscribe({next:s=>{console.log("User created:",s),this.customerData.lead_id=this.lead_id,this.customerData.userId=s.id,console.log(this.lead_id),this.customerService.createCustomerForLead(this.customerData,this.lead_id).subscribe({next:r=>{this.customerId=r.id,this.customerData.customer_type=Z.c,this.customerData.id=r.id,console.log("Customer created:",this.customerData),this.loginservice.login(this.user.email,this.user.password).subscribe(a=>{let d=JSON.parse(a);sessionStorage.setItem("token",d.token)},a=>{console.log("Login failed",a)})},error:r=>console.error("Error creating customer:",r)})},error:s=>console.error("Error creating user:",s)})):console.error("Unexpected response:",n)},n=>{console.error("Error during user existence check:",n)})}saveFormData(){let n={firstFormGroup:this.firstFormGroup.value,secondFormGroup:this.secondFormGroup.value,thirdFormGroup:this.thirdFormGroup.value,fourthFormGroup:this.fourthFormGroup.value,uploadedFiles:this.uploadedFiles};localStorage.setItem("formData",JSON.stringify(n))}saveCurrentStep(){localStorage.setItem("currentStep",JSON.stringify(this.stepper.selectedIndex))}loadCurrentStep(){let n=localStorage.getItem("currentStep");n&&(this.stepper.selectedIndex=JSON.parse(n))}loadFormData(){let n=localStorage.getItem("formData");if(n){let r=JSON.parse(n);console.log("data",r),this.firstFormGroup.patchValue(r.firstFormGroup),this.secondFormGroup.patchValue(r.secondFormGroup),this.thirdFormGroup.patchValue(r.thirdFormGroup),this.fourthFormGroup.patchValue(r.fourthFormGroup),this.uploadedFiles=r.uploadedFiles||[],this.customerData.last_Name=this.secondFormGroup.value.last_Name,this.customerData.first_Name=this.secondFormGroup.value.first_Name,this.customerData.email=this.secondFormGroup.value.email,this.customerData.phone=this.secondFormGroup.value.phone,this.customerData.connection=this.secondFormGroup.value.connection.toISOString,this.customerData.t_z=this.secondFormGroup.value.t_z,this.customerData.birthDate=this.secondFormGroup.value.birthDate,this.customerData.family_status=this.secondFormGroup.value.family_status.toISOString,this.customerData.number_of_people_in_house=this.secondFormGroup.value.number_of_people_in_house.toISOString,this.customerData.address=this.secondFormGroup.value.address,this.customerData.job_status=this.secondFormGroup.value.job_status.toISOString,this.customerData.customer_type=this.secondFormGroup.value.customer_type.toISOString,this.customerData.work_business_name=this.secondFormGroup.value.work_business_name,this.customerData.job_description=this.secondFormGroup.value.job_description,this.customerData.avarage_monthly_salary=this.secondFormGroup.value.avarage_monthly_salary.toISOString,this.customerData.years_in_current_position=this.secondFormGroup.value.years_in_current_position.toISOString,this.customerData.income_rent=this.secondFormGroup.value.income_rent.toISOString,this.customerData.income_Government_Endorsement=this.secondFormGroup.value.income_Government_Endorsement.toISOString,this.customerData.income_other=this.secondFormGroup.value.income_other.toISOString,this.customerData.expenses_rent=this.secondFormGroup.value.expenses_rent,this.customerData.expenses_loans=this.secondFormGroup.value.expenses_loans,this.customerData.expenses_other=this.secondFormGroup.value.expenses_other,this.customerData.property_city=this.thirdFormGroup.value.property_city,this.customerData.transaction_type=this.thirdFormGroup.value.transaction_type,this.customerData.estimated_price_by_customer=this.thirdFormGroup.value.estimated_price_by_customer.toISOString,this.customerData.estimated_price_by_sales_agreement=this.thirdFormGroup.value.estimated_price_by_sales_agreement.toISOString,this.customerData.has_other_properties=this.thirdFormGroup.value.has_other_properties.toISOString,this.customerData.amount_of_loan_requested=this.thirdFormGroup.value.amount_of_loan_requested.toISOString,this.customerData.isArchived=this.thirdFormGroup.value.isArchived,this.customerData.userId=this.thirdFormGroup.value.userId}let s=localStorage.getItem("customerData")}onInputChange(n,s){let r=s.target.value;this.customerData[n]=r,this.saveFormData()}onSelectionChange(n,s){n=="family_status"?(this.customerData[n]=s,this.customerData.family_status=Number(this.customerData.family_status)):n=="job_status"?(this.customerData[n]=s,this.customerData.job_status=Number(this.customerData.job_status)):n=="transaction_type"?(this.customerData[n]=s,this.customerData.transaction_type=Number(this.customerData.transaction_type)):n=="has_other_properties"?(this.customerData[n]=s,this.customerData.has_other_properties=this.customerData.has_other_properties,s===!0?this.customerData[n]=!0:this.customerData[n]=!1):n=="connection"?(this.customerData[n]=s,this.customerData.connection=Number(this.customerData.connection)):this.customerData[n]=s,this.saveFormData()}onFileChange(n){let s=n.target.files;for(let r=0;r<s.length;r++)this.uploadedFiles.push(s[r]);this.saveFormData()}removeFile(n){this.uploadedFiles.splice(n,1)}viewDocument(n){let s=URL.createObjectURL(n);window.open(s)}saveSelectionType(n){localStorage.setItem("tableData",JSON.stringify(this.tableData))}onSubmit(){this.customerService.updateCustomer(this.customerId,this.customerData).subscribe({next:n=>console.log("Customer updated not null"),error:n=>console.error("Error updating customer:",n)})}save(){return L(this,null,function*(){let n=localStorage.getItem("currentStep");console.log("Updating customer in step 3");try{console.log("iddd  "+this.customerData.id),yield le(this.customerService.updateCustomer(this.customerData.id,this.customerData)),localStorage.getItem("isAddDocuments")!=="true"&&(yield this.getDocuments(),yield this.addToCustomerTask()),this.documentsListCustomer.loadDocuments()}catch(s){console.error("Error in the process",s)}})}saveDocuments(){console.log("step 4 created"),localStorage.removeItem("enterOrNot"),localStorage.removeItem("formData"),localStorage.removeItem("currentStep"),localStorage.removeItem("ifEnter"),localStorage.removeItem("currentStepIndex"),localStorage.removeItem("tableData"),localStorage.removeItem("isAddDocuments"),location.reload()}getDocuments(){return L(this,null,function*(){let n=Number(this.customerData.transaction_type);return new Promise((s,r)=>{this.documentType.getDocsByTransactionType(n).subscribe({next:a=>{this.tableData=a,console.log("tableData",this.tableData),localStorage.setItem("tableData",JSON.stringify(this.tableData)),s(this.tableData)},error:a=>{console.error("Error fetching documents:",a),r(a)}})})})}addToCustomerTask(){return L(this,null,function*(){let n=this.tableData.map(s=>(this.document={id:0,customer_Id:this.customerData.id,task_description:s.document_Name,document_type_id:Number(this.customerData.transaction_type),document_path:"",status:0,status2:0,due_date:new Date(Date.now()),created_at:new Date(Date.now()),updated_at:new Date(Date.now()),isOk:!1,id2:0},new Promise((r,a)=>{this.customerTask.addDocument(this.document).subscribe({next:d=>{console.log("Add document successed to customerTask"),this.isAddDocuments=!0,localStorage.setItem("isAddDocuments","true"),r(d)},error:d=>{console.log("Failed to add document to CustomerTask"),a(d)}})})));return Promise.all(n)})}};o.\u0275fac=function(s){return new(s||o)(g(Be),g(A),g(Ie),g(Pe),g(k),g(Re),g(ze),g($e))},o.\u0275cmp=O({type:o,selectors:[["app-lead"]],viewQuery:function(s,r){if(s&1&&(R(M,5),R(Ke,5)),s&2){let a;z(a=U())&&(r.documentsListCustomer=a.first),z(a=U())&&(r.stepper=a.first)}},decls:176,vars:37,consts:[["stepper",""],["myButton",""],[1,"lead-body",2,"background-image","url(./assets/background.jpg)","background-size","cover","background-color","transparent","min-height","max-content 100vh","padding-top","18vh"],["dir","rtl",3,"selectionChange","linear"],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],["matInput","","formControlName","userName","required",""],[4,"ngIf"],["matInput","","formControlName","password","type","password","required",""],["mat-button","",3,"click","disabled"],["matInput","","formControlName","last_Name",3,"input"],["matInput","","type","number","formControlName","connection",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","t_z",3,"input"],["matInput","","formControlName","birthDate","type","date",3,"input"],["formControlName","family_status",3,"selectionChange"],["matInput","","formControlName","number_of_people_in_house","type","number",3,"input"],["matInput","","formControlName","address","type","text",3,"input"],["formControlName","job_status",3,"selectionChange"],["matInput","","formControlName","work_business_name","type","text",3,"input"],["matInput","","formControlName","job_description","type","text",3,"input"],["matInput","","formControlName","avarage_monthly_salary","type","number",3,"input"],["matInput","","formControlName","years_in_current_position","type","number",3,"input"],["matInput","","formControlName","income_rent","type","number",3,"input"],["matInput","","formControlName","income_Government_Endorsement","type","number",3,"input"],["matInput","","formControlName","income_other","type","number",3,"input"],["matInput","","formControlName","expenses_rent","type","number",3,"input"],["matInput","","formControlName","expenses_loans","type","number",3,"input"],["matInput","","formControlName","expenses_other","type","number",3,"input"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext",""],["matInput","","formControlName","property_city","type","text",3,"input"],["formControlName","transaction_type",3,"selectionChange"],[3,"value","click",4,"ngFor","ngForOf"],["matInput","","formControlName","estimated_price_by_customer","type","number",3,"input"],["matInput","","formControlName","estimated_price_by_sales_agreement","type","number",3,"input"],["formControlName","has_other_properties",3,"selectionChange"],["matInput","","formControlName","amount_of_loan_requested","type","number",3,"input"],["mat-button","","matStepperNext","",3,"click"],["mat-button","",3,"click"],["style","color: green;",4,"ngFor","ngForOf"],["style","color: red;",4,"ngFor","ngForOf"],[2,"color","green"],[2,"color","red"],[3,"value"],[3,"click","value"]],template:function(s,r){if(s&1){let a=P();i(0,"div",2)(1,"mat-horizontal-stepper",3,0),f("selectionChange",function(m){return _(a),h(r.onStepChange(m))}),i(3,"mat-step",4)(4,"form",5),c(5,Xe,1,0,"ng-template",6),i(6,"mat-form-field")(7,"mat-label"),u(8,"\u05D0\u05D9\u05DE\u05D9\u05D9\u05DC"),t(),q(9,"input",7),c(10,et,2,0,"mat-error",8)(11,tt,2,0,"mat-error",8),t(),i(12,"mat-form-field")(13,"mat-label"),u(14,"\u05E1\u05D9\u05E1\u05DE\u05D0"),t(),q(15,"input",9),c(16,rt,2,0,"mat-error",8),t(),c(17,ot,6,2,"div",8),i(18,"div")(19,"button",10,1),f("click",function(){return _(a),h(r.checkUserNameAndPassword())}),u(21,"\u05D4\u05D1\u05D0"),t()()()(),i(22,"mat-step",4)(23,"form",5),c(24,ut,1,0,"ng-template",6),i(25,"mat-form-field")(26,"mat-label"),u(27,"\u05E9\u05DD \u05DE\u05E9\u05E4\u05D7\u05D4"),t(),i(28,"input",11),f("input",function(m){return _(a),h(r.onInputChange("last_Name",m))}),t(),c(29,at,2,0,"mat-error",8)(30,st,2,0,"mat-error",8),t(),i(31,"mat-form-field")(32,"mat-label"),u(33,"\u05D7\u05D9\u05D1\u05D5\u05E8"),t(),i(34,"mat-select",12),f("selectionChange",function(m){return _(a),h(r.onSelectionChange("connection",m.value))}),c(35,mt,2,2,"mat-option",13),t()(),i(36,"mat-form-field")(37,"mat-label"),u(38,"\u05EA.\u05D6."),t(),i(39,"input",14),f("input",function(m){return _(a),h(r.onInputChange("t_z",m))}),t(),i(40,"mat-error"),u(41," \u05DE\u05E1\u05E4\u05E8 \u05EA\u05E2\u05D5\u05D3\u05EA \u05D6\u05D4\u05D5\u05EA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF "),t()(),i(42,"mat-form-field")(43,"mat-label"),u(44,"\u05EA\u05D0\u05E8\u05D9\u05DA \u05DC\u05D9\u05D3\u05D4"),t(),i(45,"input",15),f("input",function(m){return _(a),h(r.onInputChange("birthDate",m))}),t(),i(46,"mat-error"),u(47," \u05E0\u05D0 \u05DC\u05D4\u05DB\u05E0\u05D9\u05E1 \u05EA\u05D0\u05E8\u05D9\u05DA \u05EA\u05E7\u05D9\u05DF \u05E2\u05D3 \u05DC\u05EA\u05D0\u05E8\u05D9\u05DA \u05D4\u05E0\u05D5\u05DB\u05D7\u05D9 "),t()(),i(48,"mat-form-field")(49,"mat-label"),u(50,"\u05DE\u05E6\u05D1 \u05DE\u05E9\u05E4\u05D7\u05EA\u05D9"),t(),i(51,"mat-select",16),f("selectionChange",function(m){return _(a),h(r.onSelectionChange("family_status",m.value))}),c(52,lt,2,2,"mat-option",13),t()(),i(53,"mat-form-field")(54,"mat-label"),u(55,"\u05DE\u05E1\u05E4\u05E8 \u05D0\u05E0\u05E9\u05D9\u05DD \u05D1\u05D1\u05D9\u05EA"),t(),i(56,"input",17),f("input",function(m){return _(a),h(r.onInputChange("number_of_people_in_house",m))}),t(),c(57,pt,2,0,"mat-error",8),t(),i(58,"mat-form-field")(59,"mat-label"),u(60,"\u05DB\u05EA\u05D5\u05D1\u05EA"),t(),i(61,"input",18),f("input",function(m){return _(a),h(r.onInputChange("address",m))}),t(),c(62,dt,2,0,"mat-error",8),t(),i(63,"h3"),u(64,"\u05E4\u05E8\u05D8\u05D9 \u05EA\u05E2\u05E1\u05D5\u05E7\u05D4"),t(),i(65,"mat-form-field")(66,"mat-label"),u(67,"\u05E1\u05D8\u05D8\u05D5\u05E1"),t(),i(68,"mat-select",19),f("selectionChange",function(m){return _(a),h(r.onSelectionChange("job_status",m.value))}),c(69,Dt,2,2,"mat-option",13),t()(),i(70,"mat-form-field")(71,"mat-label"),u(72,"\u05DE\u05E7\u05D5\u05DD \u05E2\u05D1\u05D5\u05D3\u05D4"),t(),i(73,"input",20),f("input",function(m){return _(a),h(r.onInputChange("work_business_name",m))}),t(),c(74,ct,2,0,"mat-error",8),t(),i(75,"mat-form-field")(76,"mat-label"),u(77,"\u05EA\u05E4\u05E7\u05D9\u05D3"),t(),i(78,"input",21),f("input",function(m){return _(a),h(r.onInputChange("job_description",m))}),t(),c(79,_t,2,0,"mat-error",8),t(),i(80,"mat-form-field")(81,"mat-label"),u(82,"\u05DE\u05E9\u05DB\u05D5\u05E8\u05EA \u05D7\u05D5\u05D3\u05E9\u05D9\u05EA \u05DE\u05DE\u05D5\u05E6\u05E2\u05EA \u05E0\u05D8\u05D5"),t(),i(83,"input",22),f("input",function(m){return _(a),h(r.onInputChange("avarage_monthly_salary",m))}),t(),c(84,ht,2,0,"mat-error",8),t(),i(85,"mat-form-field")(86,"mat-label"),u(87,"\u05D5\u05EA\u05E7"),t(),i(88,"input",23),f("input",function(m){return _(a),h(r.onInputChange("years_in_current_position",m))}),t(),c(89,ft,2,0,"mat-error",8),t(),i(90,"h3"),u(91,"\u05D4\u05DB\u05E0\u05E1\u05D5\u05EA"),t(),i(92,"mat-form-field")(93,"mat-label"),u(94,"\u05E7\u05E6\u05D1\u05D0\u05D5\u05EA"),t(),i(95,"input",24),f("input",function(m){return _(a),h(r.onInputChange("income_rent",m))}),t(),c(96,Et,2,0,"mat-error",8),t(),i(97,"mat-form-field")(98,"mat-label"),u(99,"\u05DE\u05D6\u05D5\u05E0\u05D5\u05EA"),t(),i(100,"input",25),f("input",function(m){return _(a),h(r.onInputChange("income_Government_Endorsement",m))}),t(),c(101,gt,2,0,"mat-error",8),t(),i(102,"mat-form-field")(103,"mat-label"),u(104,"\u05DE\u05E7\u05D5\u05E8 \u05D0\u05D7\u05E8"),t(),i(105,"input",26),f("input",function(m){return _(a),h(r.onInputChange("income_other",m))}),t(),c(106,vt,2,0,"mat-error",8),t(),i(107,"h3"),u(108,"\u05D4\u05D5\u05E6\u05D0\u05D5\u05EA"),t(),i(109,"mat-form-field")(110,"mat-label"),u(111,"\u05E9\u05DB\u05E8 \u05D3\u05D9\u05E8\u05D4"),t(),i(112,"input",27),f("input",function(m){return _(a),h(r.onInputChange("expenses_rent",m))}),t(),c(113,St,2,0,"mat-error",8),t(),i(114,"mat-form-field")(115,"mat-label"),u(116,"\u05D4\u05DC\u05D5\u05D5\u05D0\u05D5\u05EA"),t(),i(117,"input",28),f("input",function(m){return _(a),h(r.onInputChange("expenses_loans",m))}),t(),c(118,Ct,2,0,"mat-error",8),t(),i(119,"mat-form-field")(120,"mat-label"),u(121,"\u05DE\u05E7\u05D5\u05E8 \u05D0\u05D7\u05E8"),t(),i(122,"input",29),f("input",function(m){return _(a),h(r.onInputChange("expenses_other",m))}),t(),c(123,bt,2,0,"mat-error",8),t(),i(124,"div")(125,"button",30),u(126,"\u05D7\u05D6\u05D5\u05E8"),t(),i(127,"button",31),u(128,"\u05D4\u05D1\u05D0"),t()()()(),i(129,"mat-step",4)(130,"form",5),c(131,yt,1,0,"ng-template",6),i(132,"mat-form-field")(133,"mat-label"),u(134,"\u05D9\u05D9\u05E9\u05D5\u05D1"),t(),i(135,"input",32),f("input",function(m){return _(a),h(r.onInputChange("property_city",m))}),t(),c(136,wt,2,0,"mat-error",8),t(),i(137,"mat-form-field")(138,"mat-label"),u(139,"\u05E1\u05D5\u05D2 \u05E2\u05E1\u05E7\u05D4"),t(),i(140,"mat-select",33),f("selectionChange",function(m){return _(a),h(r.onSelectionChange("transaction_type",m.value))}),c(141,It,2,2,"mat-option",34),t()(),i(142,"mat-form-field")(143,"mat-label"),u(144,"\u05E9\u05D5\u05D5\u05D9 \u05D4\u05E0\u05DB\u05E1 \u05DC\u05E4\u05D9 \u05D4\u05E2\u05E8\u05DB\u05EA \u05DC\u05D5\u05D5\u05D4"),t(),i(145,"input",35),f("input",function(m){return _(a),h(r.onInputChange("estimated_price_by_customer",m))}),t(),c(146,Ft,2,0,"mat-error",8),t(),i(147,"mat-form-field")(148,"mat-label"),u(149,"\u05E9\u05D5\u05D5\u05D4 \u05D4\u05E0\u05DB\u05E1 \u05DC\u05E4\u05D9 \u05D4\u05E1\u05DB\u05DD \u05DE\u05DB\u05E8"),t(),i(150,"input",36),f("input",function(m){return _(a),h(r.onInputChange("estimated_price_by_sales_agreement",m))}),t(),c(151,xt,2,0,"mat-error",8),t(),i(152,"mat-form-field")(153,"mat-label"),u(154,"\u05D9\u05E9 \u05E0\u05DB\u05E1\u05D9\u05DD \u05E0\u05D5\u05E1\u05E4\u05D9\u05DD \u05DC\u05DC\u05D5\u05D5\u05D4"),t(),i(155,"mat-select",37),f("selectionChange",function(m){return _(a),h(r.onSelectionChange("has_other_properties",m.value))}),c(156,Gt,2,2,"mat-option",13),t()(),i(157,"mat-form-field")(158,"mat-label"),u(159,"\u05E1\u05DB\u05D5\u05DD \u05D4\u05D4\u05DC\u05D5\u05D5\u05D0\u05D4"),t(),i(160,"input",38),f("input",function(m){return _(a),h(r.onInputChange("amount_of_loan_requested",m))}),t(),c(161,Nt,2,0,"mat-error",8),t(),i(162,"div")(163,"button",30),u(164,"\u05D7\u05D6\u05D5\u05E8"),t(),i(165,"button",39),f("click",function(){return _(a),h(r.save())}),u(166,"\u05D4\u05D1\u05D0"),t()()()(),i(167,"mat-step",4)(168,"form",5),c(169,Lt,1,0,"ng-template",6),q(170,"documents-list-customer"),i(171,"div")(172,"button",30),u(173,"\u05D7\u05D6\u05D5\u05E8"),t(),i(174,"button",40),f("click",function(){return _(a),h(r.saveDocuments())}),u(175,"\u05E9\u05DE\u05D5\u05E8"),t()()()()()()}if(s&2){let a,d,m,y,w,I,v,F,x,G,N,X,ee,te,re,ie,ne,oe,ue,ae,se,me;l(),p("linear",r.isLinear),l(2),p("stepControl",r.firstFormGroup),l(),p("formGroup",r.firstFormGroup),l(6),p("ngIf",(a=r.firstFormGroup.get("userName"))==null?null:a.hasError("required")),l(),p("ngIf",(d=r.firstFormGroup.get("userName"))==null?null:d.hasError("email")),l(5),p("ngIf",(m=r.firstFormGroup.get("password"))==null?null:m.hasError("required")),l(),p("ngIf",(y=r.firstFormGroup.get("password"))==null?null:y.touched),l(2),p("disabled",r.firstFormGroup.invalid),l(3),p("stepControl",r.secondFormGroup),l(),p("formGroup",r.secondFormGroup),l(6),p("ngIf",(w=r.secondFormGroup.get("last_Name"))==null?null:w.hasError("required")),l(),p("ngIf",(I=r.secondFormGroup.get("last_Name"))==null?null:I.hasError("pattern")),l(5),p("ngForOf",r.connectionOptions),l(17),p("ngForOf",r.familyStatusOptions),l(5),p("ngIf",(v=r.secondFormGroup.get("number_of_people_in_house"))==null?null:v.hasError("required")),l(5),p("ngIf",(F=r.secondFormGroup.get("address"))==null?null:F.hasError("required")),l(7),p("ngForOf",r.jobStatusOptions),l(5),p("ngIf",(x=r.secondFormGroup.get("work_business_name"))==null?null:x.hasError("required")),l(5),p("ngIf",(G=r.secondFormGroup.get("job_description"))==null?null:G.hasError("required")),l(5),p("ngIf",(N=r.secondFormGroup.get("avarage_monthly_salary"))==null?null:N.hasError("required")),l(5),p("ngIf",(X=r.secondFormGroup.get("years_in_current_position"))==null?null:X.hasError("required")),l(7),p("ngIf",(ee=r.secondFormGroup.get("income_rent"))==null?null:ee.hasError("required")),l(5),p("ngIf",(te=r.secondFormGroup.get("income_Government_Endorsement"))==null?null:te.hasError("required")),l(5),p("ngIf",(re=r.secondFormGroup.get("income_other"))==null?null:re.hasError("required")),l(7),p("ngIf",(ie=r.secondFormGroup.get("expenses_rent"))==null?null:ie.hasError("required")),l(5),p("ngIf",(ne=r.secondFormGroup.get("expenses_loans"))==null?null:ne.hasError("required")),l(5),p("ngIf",(oe=r.secondFormGroup.get("expenses_other"))==null?null:oe.hasError("required")),l(6),p("stepControl",r.thirdFormGroup),l(),p("formGroup",r.thirdFormGroup),l(6),p("ngIf",(ue=r.thirdFormGroup.get("property_city"))==null?null:ue.hasError("required")),l(5),p("ngForOf",r.transactiontypeOptions),l(5),p("ngIf",(ae=r.thirdFormGroup.get("estimated_price_by_customer"))==null?null:ae.hasError("required")),l(5),p("ngIf",(se=r.thirdFormGroup.get("estimated_price_by_sales_agreement"))==null?null:se.hasError("required")),l(5),p("ngForOf",r.hasOtherProperties),l(5),p("ngIf",(me=r.thirdFormGroup.get("amount_of_loan_requested"))==null?null:me.hasError("required")),l(6),p("stepControl",r.fourthFormGroup),l(),p("formGroup",r.fourthFormGroup)}},dependencies:[pe,de,_e,Le,Ge,Ne,Ve,xe,qe,Te,Ae,ke,Me,Oe,he,Se,fe,Ce,Ee,ge,we,be,ye,M],styles:['mat-form-field[_ngcontent-%COMP%]{width:100%}button[_ngcontent-%COMP%]{margin-right:8px}h3[_ngcontent-%COMP%]{margin-top:20px}.invalid-requirement[_ngcontent-%COMP%]{color:red}.valid-requirement[_ngcontent-%COMP%]{color:green}mat-horizontal-stepper[_ngcontent-%COMP%]{width:50vw;margin:0 auto}#content[_ngcontent-%COMP%]{background-color:#ffffff9a;padding:25px;border-radius:40px;min-width:max-content;min-height:60vh}.mat-stepper-horizontal.mat-stepper-label-position-end.ng-tns-c3820311392-0[_ngcontent-%COMP%]{z-index:1}.lead-body[_ngcontent-%COMP%]{background-image:url("./media/background-M3CTWIGI.jpg");height:100vh;background-size:cover;background-color:transparent;padding-top:18vh}']});let e=o;return e})();var We=(()=>{let o=class o{constructor(n,s,r){this.route=n,this.leadService=s,this.router=r,this.id=null,this.token=null,this.isNotValid=!1}ngOnInit(){console.log("in ngooninit of magic link"),this.route.queryParams.subscribe(n=>{this.id=n.id,this.token=n.token,console.log("ID:",this.id),console.log("Token:",this.token)}),this.id!=null&&this.leadService.checkToken(this.id).subscribe(n=>{n.status===200?(this.router.navigate(["lead/lead",this?.id]),console.log("jiii")):this.isNotValid=!0},n=>{console.error("Error checking token:",n),this.isNotValid=!0})}};o.\u0275fac=function(s){return new(s||o)(g(A),g(k),g(ce))},o.\u0275cmp=O({type:o,selectors:[["app-magic-link"]],decls:2,vars:0,template:function(s,r){s&1&&(i(0,"p"),u(1,"magic-link works!"),t())}});let e=o;return e})();var Vt=[{path:"",component:K},{path:"lead/:id",component:K},{path:"magic-link",component:We}],Ye=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=T({type:o}),o.\u0275inj=V({imports:[Q.forChild(Vt),Q]});let e=o;return e})();var Or=(()=>{let o=class o{};o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=T({type:o}),o.\u0275inj=V({imports:[De,je,Fe,Ye,Ue]});let e=o;return e})();export{Or as a};
