import './polyfills.server.mjs';
import{a as ze}from"./chunk-MOPF5JQC.mjs";import{G as Re,M as Ue,d as Be,e as Pe,m as k,o as $e}from"./chunk-QQ6DYRED.mjs";import{A as we,C as Ie,F as Fe,Pa as Me,Ra as z,Sa as je,Z as xe,_ as Ge,ba as Ne,ca as Ve,i as ce,k as _e,la as Le,m as he,n as D,o as fe,p as Ee,q as ge,ra as Oe,s as U,sa as Te,ta as Ae,u as Se,ua as qe,v as ve,va as ke,x as Ce,y as be,z as ye}from"./chunk-B3SZUYRB.mjs";import{r as q,u as De,w as R}from"./chunk-TIRFLIF6.mjs";import{Cb as i,Db as t,Eb as A,Ib as B,Lb as f,Nb as P,Sb as ae,Tb as se,Ub as me,Wb as u,Xb as C,Xc as le,Yb as $,Yc as pe,Za as l,_ as L,_a as g,cd as de,ha as O,ia as T,p as ue,pa as _,qa as h,rb as c,tb as p}from"./chunk-ZE4Y54UW.mjs";import{h as V}from"./chunk-NDYDZJSS.mjs";function Je(){return e=>{let o=new Date(e.value),E=new Date;return o>E?{invalidBirthDate:!0}:o.getFullYear()>E.getFullYear()?{invalidBirthDate:!0}:null}}function Qe(){return e=>{let o=e.value;return o?/^\d{9}$/.test(o)?Array.from(o,Number).reduce((n,m,r)=>{let a=m*(r%2+1);return n+(a>9?a-9:a)},0)%10!==0?{invalidIsraeliId:!0}:null:{invalidIsraeliId:!0}:null}}var b=function(e){return e[e.Single=0]="Single",e[e.Married=1]="Married",e[e.Divorced=2]="Divorced",e[e.Widowed=3]="Widowed",e}(b||{}),M=function(e){return e[e.Employed=0]="Employed",e[e.SelfEmployed=1]="SelfEmployed",e}(M||{}),v=function(e){return e[e.\u05DE\u05D7\u05D9\u05E8_\u05DC\u05DE\u05E9\u05EA\u05DB\u05DF=0]="\u05DE\u05D7\u05D9\u05E8_\u05DC\u05DE\u05E9\u05EA\u05DB\u05DF",e[e.New=1]="New",e[e.Old=2]="Old",e[e.Renovation=3]="Renovation",e[e.Other=4]="Other",e}(v||{}),j=function(e){return e[e.whatup=0]="whatup",e[e.email=1]="email",e}(j||{}),J=function(e){return e[e.l=0]="l",e[e.c=1]="c",e[e.a=2]="a",e}(J||{});var Ke=["stepper"];function Xe(e,o){e&1&&u(0,"\u05D4\u05D2\u05D3\u05E8\u05EA \u05E9\u05DD \u05DE\u05E9\u05EA\u05DE\u05E9 \u05D5\u05E1\u05D9\u05E1\u05DE\u05D0")}function et(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function tt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05D0\u05D9\u05DE\u05D9\u05D9\u05DC \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF"),t())}function rt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function it(e,o){if(e&1&&(i(0,"li",42),u(1),t()),e&2){let E=o.$implicit;l(),$(" ",E," ")}}function nt(e,o){if(e&1&&(i(0,"li",43),u(1),t()),e&2){let E=o.$implicit;l(),$(" ",E," ")}}function ot(e,o){if(e&1&&(i(0,"div")(1,"p"),u(2,"\u05D3\u05E8\u05D9\u05E9\u05D5\u05EA \u05DC\u05E1\u05D9\u05E1\u05DE\u05D4 \u05D7\u05D6\u05E7\u05D4:"),t(),i(3,"ul"),c(4,it,2,1,"li",40)(5,nt,2,1,"li",41),t()()),e&2){let E=P();l(4),p("ngForOf",E.passwordStrength.valid),l(),p("ngForOf",E.passwordStrength.invalid)}}function ut(e,o){e&1&&u(0,"\u05E2\u05D3\u05DB\u05D5\u05DF \u05E4\u05E8\u05D8\u05D9\u05DD \u05D0\u05D9\u05E9\u05D9\u05D9\u05DD")}function at(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function st(e,o){e&1&&(i(0,"mat-error"),u(1," \u05D9\u05E9 \u05DC\u05DB\u05EA\u05D5\u05D1 \u05D1\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05E8\u05E7 \u05D0\u05D5\u05EA\u05D9\u05D5\u05EA "),t())}function mt(e,o){if(e&1&&(i(0,"mat-option",44),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function lt(e,o){if(e&1&&(i(0,"mat-option",44),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function pt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function dt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Dt(e,o){if(e&1&&(i(0,"mat-option",44),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function ct(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function _t(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function ht(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function ft(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Et(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E7\u05E6\u05D1\u05D0\u05D5\u05EA \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function gt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05DE\u05D6\u05D5\u05E0\u05D5\u05EA \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function St(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E2\u05D5\u05D3 \u05DE\u05E7\u05D5\u05E8 \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function vt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function Ct(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function bt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D6\u05D4 \u05D4\u05D5\u05D0 \u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4 \u05D1\u05DE\u05D9\u05D3\u05D4 \u05D5\u05D0\u05D9\u05DF \u05E0\u05D0 \u05DC\u05D4\u05E7\u05D9\u05E9 0"),t())}function yt(e,o){e&1&&u(0,"\u05E4\u05E8\u05D8\u05D9 \u05D4\u05E0\u05DB\u05E1")}function wt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function It(e,o){if(e&1){let E=B();i(0,"mat-option",45),f("click",function(){let m=_(E).$implicit,r=P();return h(r.saveSelectionType(m.value))}),u(1),t()}if(e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function Ft(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function xt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Gt(e,o){if(e&1&&(i(0,"mat-option",44),u(1),t()),e&2){let E=o.$implicit;p("value",E.value),l(),C(E.label)}}function Nt(e,o){e&1&&(i(0,"mat-error"),u(1,"\u05E9\u05D3\u05D4 \u05D7\u05D5\u05D1\u05D4"),t())}function Vt(e,o){e&1&&u(0,"\u05D4\u05E2\u05DC\u05D0\u05EA \u05DE\u05E1\u05DE\u05DB\u05D9\u05DD")}var W=(()=>{let o=class o{constructor(n,m,r,a,d,s,y,w){this.loginservice=n,this.route=m,this._formBuilder=r,this.customerService=a,this.leadService=d,this.userService=s,this.documentType=y,this.customerTask=w,this.user={id:0,userName:"",password:"",email:"",role:z.Customer,created_at:new Date(Date.now()),updated_at:new Date(Date.now())},this.currentStepIndex=0,this.isCustomer=!1,this.isLead=!1,this.isLinear=!0,this.isAddDocuments=!1,this.res="",this.lead_id=null,this.uploadedFiles=[],this.showTable=!1,this.tableData=[],this.document={id:0,customer_Id:0,task_description:"",document_type_id:0,document_path:"",status:0,status2:0,due_date:new Date(Date.now()),created_at:new Date(Date.now()),updated_at:new Date(Date.now()),isOk:!1,id2:0},this.customerData={id:0,lead_id:0,last_Name:"",first_Name:"",email:"",phone:"",connection:0,t_z:"",birthDate:new Date(Date.now()),family_status:0,number_of_people_in_house:0,address:"",job_status:0,customer_type:0,work_business_name:"",job_description:"",avarage_monthly_salary:0,years_in_current_position:0,income_rent:0,income_Government_Endorsement:0,income_other:0,expenses_rent:0,expenses_loans:0,expenses_other:0,property_city:"",transaction_type:0,estimated_price_by_customer:0,estimated_price_by_sales_agreement:0,has_other_properties:!1,amount_of_loan_requested:0,lastSynced:new Date(Date.now()),isArchived:!1,created_at:new Date(Date.now()),updated_at:new Date(Date.now())},this.familyStatusOptions=[{value:b.Single,label:"\u05E8\u05D5\u05D5\u05E7"},{value:b.Married,label:"\u05E0\u05E9\u05D5\u05D9"},{value:b.Divorced,label:"\u05D2\u05E8\u05D5\u05E9"},{value:b.Widowed,label:"\u05D0\u05DC\u05DE\u05DF"}],this.jobStatusOptions=[{value:M.Employed,label:"\u05E9\u05DB\u05D9\u05E8"},{value:M.SelfEmployed,label:"\u05E2\u05E6\u05DE\u05D0\u05D9"}],this.transactiontypeOptions=[{value:v.\u05DE\u05D7\u05D9\u05E8_\u05DC\u05DE\u05E9\u05EA\u05DB\u05DF,label:"\u05DE\u05D7\u05D9\u05E8 \u05DC\u05DE\u05E9\u05EA\u05DB\u05DF"},{value:v.New,label:"\u05D9\u05D3 \u05E8\u05D0\u05E9\u05D5\u05E0\u05D4"},{value:v.Old,label:"\u05D9\u05D3 \u05E9\u05E0\u05D9\u05D4"},{value:v.Renovation,label:"\u05E9\u05D9\u05E4\u05D5\u05E6\u05D9\u05DD"},{value:v.Other,label:"\u05DC\u05DB\u05DC \u05DE\u05D8\u05E8\u05D4"}],this.connectionOptions=[{value:j.whatup,label:"\u05D5\u05D5\u05D0\u05E6\u05D0\u05E4"},{value:j.email,label:"\u05DE\u05D9\u05D9\u05DC"}],this.hasOtherProperties=[{value:!0,label:"\u05DB\u05DF"},{value:!1,label:"\u05DC\u05D0"}],this.passwordStrength={valid:[],invalid:[]},this.passwordStrengthValidator=I=>{let S=I.value,F=/[A-Z]/.test(S),x=/[a-z]/.test(S),G=/[0-9]/.test(S),N=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(S);return this.passwordStrength.valid=[],this.passwordStrength.invalid=[],S.length>=10?this.passwordStrength.valid.push("\u05D0\u05D5\u05E8\u05DA 10 \u05EA\u05D5\u05D5\u05D9\u05DD \u05DC\u05E4\u05D7\u05D5\u05EA"):this.passwordStrength.invalid.push("\u05D0\u05D5\u05E8\u05DA 10 \u05EA\u05D5\u05D5\u05D9\u05DD \u05DC\u05E4\u05D7\u05D5\u05EA"),F?this.passwordStrength.valid.push("\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D4"):this.passwordStrength.invalid.push("\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D4"),x?this.passwordStrength.valid.push("\u05D0\u05D5\u05EA \u05E7\u05D8\u05E0\u05D4"):this.passwordStrength.invalid.push("\u05D0\u05D5\u05EA \u05E7\u05D8\u05E0\u05D4"),G?this.passwordStrength.valid.push("\u05DE\u05E1\u05E4\u05E8"):this.passwordStrength.invalid.push("\u05DE\u05E1\u05E4\u05E8"),N?this.passwordStrength.valid.push("\u05EA\u05D5 \u05DE\u05D9\u05D5\u05D7\u05D3"):this.passwordStrength.invalid.push("\u05EA\u05D5 \u05DE\u05D9\u05D5\u05D7\u05D3"),this.passwordStrength.invalid.length===0?null:{passwordStrength:!0}},this.firstFormGroup=new ge({userName:new U({value:"",disabled:!1},[D.required,D.email]),password:new U({value:"",disabled:!1},[D.required,D.minLength(10),this.passwordStrengthValidator])}),this.secondFormGroup=this._formBuilder.group({last_Name:["",[D.pattern("^[a-zA-Z\u05D0-\u05EA ]*$"),D.required]],first_Name:[""],email:[""],phone:[""],connection:[""],t_z:["",[D.required,Qe()]],birthDate:["",[D.required,Je()]],family_status:["",D.required],number_of_people_in_house:["",[D.pattern("^[0-9]*$"),D.required]],address:["",D.required],job_status:[""],customer_type:[""],work_business_name:["",D.required],job_description:["",D.required],avarage_monthly_salary:["",[D.pattern("^[0-9]*$"),D.required]],years_in_current_position:["",[D.pattern("^[0-9]*$"),D.required]],income_rent:["",[D.pattern("^[0-9]*$"),D.required]],income_Government_Endorsement:["",[D.pattern("^[0-9]*$"),D.required]],income_other:["",[D.pattern("^[0-9]*$"),D.required]],expenses_rent:["",[D.pattern("^[0-9]*$"),D.required]],expenses_loans:["",[D.pattern("^[0-9]*$"),D.required]],expenses_other:["",D.required]}),this.thirdFormGroup=this._formBuilder.group({property_city:["",D.required],transaction_type:["",D.required],estimated_price_by_customer:["",D.required],estimated_price_by_sales_agreement:["",D.required],has_other_properties:["",D.required],amount_of_loan_requested:["",D.required]}),this.fourthFormGroup=this._formBuilder.group({documents:["",D.required]})}ngOnInit(){console.log("in ngOnInit of lead"),this.route.paramMap.subscribe(d=>{this.lead_id=Number(d.get("id"))}),localStorage.getItem("enterOrNot")===null&&localStorage.setItem("enterOrNot","false");let n=localStorage.getItem("userName"),m=localStorage.getItem("password");n!==null&&m!==null&&(this.firstFormGroup.setValue({userName:JSON.parse(n),password:JSON.parse(m)}),this.firstFormGroup.get("userName")?.disable(),this.firstFormGroup.get("password")?.disable());let r=localStorage.getItem("currentStep");r!==null&&(this.currentStepIndex=parseInt(r,10));let a=localStorage.getItem("tableData");a&&(this.tableData=JSON.parse(a)),this.loadFormData()}loadCustomerDataFromLocalStorage(){let n=localStorage.getItem("customerData");n&&(this.customerData=JSON.parse(n))}onStepChange(n){this.currentStepIndex=n.selectedIndex,localStorage.setItem("currentStep",this.currentStepIndex.toString())}ngAfterViewInit(){this.loadCurrentStep()}isReturningUser(){return localStorage.getItem("enterOrNot")==="true"}checkUserNameAndPassword(){this.leadService.getLeadById(this.lead_id).subscribe(n=>{n&&(this.customerData.phone=n.phone,this.customerData.email=n.email,this.customerData.first_Name=n.first_Name)}),this.user.id=0,this.user.userName=this.firstFormGroup.value.userName,this.user.password=this.firstFormGroup.value.password,this.user.email=this.firstFormGroup.value.userName,this.user.role=z.Customer,this.user.created_at=new Date(Date.now()),this.user.updated_at=new Date(Date.now()),this.userService.IsExist(this.user).subscribe(n=>{localStorage.setItem("userName",JSON.stringify(this.user.userName)),localStorage.setItem("password",JSON.stringify(this.user.password)),this.res=n,n==="200"?localStorage.getItem("enterOrNot")==="true"?this.stepper.next():alert("\u05D0\u05D9\u05D9\u05DE\u05D9\u05DC \u05D0\u05D5 \u05E1\u05D9\u05E1\u05DE\u05D0 \u05EA\u05E4\u05D5\u05E1\u05D9\u05DD \u05E0\u05D0 \u05DC\u05D4\u05DB\u05E0\u05D9\u05E1 \u05D0\u05D7\u05E8"):n==="404"&&this.user!==null&&this.user!==void 0&&this.user.password!==""&&this.user.userName!==""?(localStorage.setItem("enterOrNot","true"),this.stepper.next(),this.userService.createUserForLead(this.user,this.lead_id).subscribe({next:m=>{console.log("User created:",this.user),this.customerData.lead_id=this.lead_id,this.customerService.createCustomerForLead(this.customerData,this.lead_id).subscribe({next:r=>{debugger;this.customerId=r.id,this.customerData.customer_type=J.c,console.log("Customer created:",this.customerData),this.loginservice.login(this.user.email,this.user.password).subscribe(a=>{let d=JSON.parse(a);sessionStorage.setItem("token",d.token)},a=>{console.log("Login failed",a)})},error:r=>console.error("Error creating customer:",r)})},error:m=>console.error("Error creating user:",m)})):console.error("Unexpected response:",n)},n=>{console.error("Error during user existence check:",n)})}saveFormData(){let n={firstFormGroup:this.firstFormGroup.value,secondFormGroup:this.secondFormGroup.value,thirdFormGroup:this.thirdFormGroup.value,fourthFormGroup:this.fourthFormGroup.value,uploadedFiles:this.uploadedFiles};localStorage.setItem("formData",JSON.stringify(n))}saveCurrentStep(){localStorage.setItem("currentStep",JSON.stringify(this.stepper.selectedIndex))}loadCurrentStep(){let n=localStorage.getItem("currentStep");n&&(this.stepper.selectedIndex=JSON.parse(n))}loadFormData(){let n=localStorage.getItem("formData");if(n){let r=JSON.parse(n);console.log("data",r),this.firstFormGroup.patchValue(r.firstFormGroup),this.secondFormGroup.patchValue(r.secondFormGroup),this.thirdFormGroup.patchValue(r.thirdFormGroup),this.fourthFormGroup.patchValue(r.fourthFormGroup),this.uploadedFiles=r.uploadedFiles||[],this.customerData.last_Name=this.secondFormGroup.value.last_Name,this.customerData.first_Name=this.secondFormGroup.value.first_Name,this.customerData.email=this.secondFormGroup.value.email,this.customerData.phone=this.secondFormGroup.value.phone,this.customerData.connection=this.secondFormGroup.value.connection.toISOString,this.customerData.t_z=this.secondFormGroup.value.t_z,this.customerData.birthDate=this.secondFormGroup.value.birthDate,this.customerData.family_status=this.secondFormGroup.value.family_status.toISOString,this.customerData.number_of_people_in_house=this.secondFormGroup.value.number_of_people_in_house.toISOString,this.customerData.address=this.secondFormGroup.value.address,this.customerData.job_status=this.secondFormGroup.value.job_status.toISOString,this.customerData.customer_type=this.secondFormGroup.value.customer_type.toISOString,this.customerData.work_business_name=this.secondFormGroup.value.work_business_name,this.customerData.job_description=this.secondFormGroup.value.job_description,this.customerData.avarage_monthly_salary=this.secondFormGroup.value.avarage_monthly_salary.toISOString,this.customerData.years_in_current_position=this.secondFormGroup.value.years_in_current_position.toISOString,this.customerData.income_rent=this.secondFormGroup.value.income_rent.toISOString,this.customerData.income_Government_Endorsement=this.secondFormGroup.value.income_Government_Endorsement.toISOString,this.customerData.income_other=this.secondFormGroup.value.income_other.toISOString,this.customerData.expenses_rent=this.secondFormGroup.value.expenses_rent,this.customerData.expenses_loans=this.secondFormGroup.value.expenses_loans,this.customerData.expenses_other=this.secondFormGroup.value.expenses_other,this.customerData.property_city=this.thirdFormGroup.value.property_city,this.customerData.transaction_type=this.thirdFormGroup.value.transaction_type,this.customerData.estimated_price_by_customer=this.thirdFormGroup.value.estimated_price_by_customer.toISOString,this.customerData.estimated_price_by_sales_agreement=this.thirdFormGroup.value.estimated_price_by_sales_agreement.toISOString,this.customerData.has_other_properties=this.thirdFormGroup.value.has_other_properties.toISOString,this.customerData.amount_of_loan_requested=this.thirdFormGroup.value.amount_of_loan_requested.toISOString,this.customerData.isArchived=this.thirdFormGroup.value.isArchived}let m=localStorage.getItem("customerData")}onInputChange(n,m){let r=m.target.value;this.customerData[n]=r,this.saveFormData()}onSelectionChange(n,m){n=="family_status"?(this.customerData[n]=m,this.customerData.family_status=Number(this.customerData.family_status)):n=="job_status"?(this.customerData[n]=m,this.customerData.job_status=Number(this.customerData.job_status)):n=="transaction_type"?(this.customerData[n]=m,this.customerData.transaction_type=Number(this.customerData.transaction_type)):n=="has_other_properties"?(this.customerData[n]=m,this.customerData.has_other_properties=this.customerData.has_other_properties,m===!0?this.customerData[n]=!0:this.customerData[n]=!1):n=="connection"?(this.customerData[n]=m,this.customerData.connection=Number(this.customerData.connection)):this.customerData[n]=m,this.saveFormData()}onFileChange(n){let m=n.target.files;for(let r=0;r<m.length;r++)this.uploadedFiles.push(m[r]);this.saveFormData()}removeFile(n){this.uploadedFiles.splice(n,1)}viewDocument(n){let m=URL.createObjectURL(n);window.open(m)}saveSelectionType(n){localStorage.setItem("tableData",JSON.stringify(this.tableData))}onSubmit(){this.customerService.updateCustomer(this.customerId,this.customerData).subscribe({next:n=>console.log("Customer updated not null"),error:n=>console.error("Error updating customer:",n)})}save(){return V(this,null,function*(){let n=localStorage.getItem("currentStep");console.log("Updating customer in step 3");try{yield ue(this.customerService.updateCustomer(this.customerData.id,this.customerData)),yield this.getDocuments(),localStorage.getItem("isAddDocuments")!=="true"&&(yield this.addToCustomerTask())}catch(m){console.error("Error in the process",m)}})}saveDocuments(){this.customerService.updateCustomer(this.customerId,this.customerData).subscribe({next:n=>{console.log("step 4 created"),localStorage.removeItem("enterOrNot"),localStorage.removeItem("formData"),localStorage.removeItem("currentStep"),localStorage.removeItem("ifEnter"),localStorage.removeItem("currentStepIndex"),localStorage.removeItem("tableData"),localStorage.removeItem("isAddDocuments"),location.reload()}})}getDocuments(){return V(this,null,function*(){let n=Number(this.customerData.transaction_type);return new Promise((m,r)=>{this.documentType.getDocsByTransactionType(n).subscribe({next:a=>{this.tableData=a,console.log("tableData",this.tableData),localStorage.setItem("tableData",JSON.stringify(this.tableData)),m(this.tableData)},error:a=>{console.error("Error fetching documents:",a),r(a)}})})})}addToCustomerTask(){return V(this,null,function*(){let n=this.tableData.map(m=>(this.document={id:0,customer_Id:this.customerData.id,task_description:m.document_Name,document_type_id:Number(this.customerData.transaction_type),document_path:"\u05DC\u05D1\u05D3\u05D5\u05E7 \u05DE\u05D4 \u05DB\u05D5\u05EA\u05D1\u05D9\u05DD \u05E4\u05D4",status:0,status2:0,due_date:new Date(Date.now()),created_at:new Date(Date.now()),updated_at:new Date(Date.now()),isOk:!1,id2:0},new Promise((r,a)=>{this.customerTask.addDocument(this.document).subscribe({next:d=>{console.log("Add document successed to customerTask"),this.isAddDocuments=!0,localStorage.setItem("isAddDocuments","true"),r(d)},error:d=>{console.log("Failed to add document to CustomerTask"),a(d)}})})));return Promise.all(n)})}};o.\u0275fac=function(m){return new(m||o)(g(je),g(q),g(we),g(Be),g(k),g($e),g(Re),g(Pe))},o.\u0275cmp=O({type:o,selectors:[["app-lead"]],viewQuery:function(m,r){if(m&1&&ae(Ke,5),m&2){let a;se(a=me())&&(r.stepper=a.first)}},decls:175,vars:37,consts:[["stepper",""],["myButton",""],["dir","rtl",3,"selectionChange","linear"],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],["matInput","","formControlName","userName","required",""],[4,"ngIf"],["matInput","","formControlName","password","type","password","required",""],["mat-button","",3,"click","disabled"],["matInput","","formControlName","last_Name",3,"input"],["matInput","","type","number","formControlName","connection",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","t_z",3,"input"],["matInput","","formControlName","birthDate","type","date",3,"input"],["formControlName","family_status",3,"selectionChange"],["matInput","","formControlName","number_of_people_in_house","type","number",3,"input"],["matInput","","formControlName","address","type","text",3,"input"],["formControlName","job_status",3,"selectionChange"],["matInput","","formControlName","work_business_name","type","text",3,"input"],["matInput","","formControlName","job_description","type","text",3,"input"],["matInput","","formControlName","avarage_monthly_salary","type","number",3,"input"],["matInput","","formControlName","years_in_current_position","type","number",3,"input"],["matInput","","formControlName","income_rent","type","number",3,"input"],["matInput","","formControlName","income_Government_Endorsement","type","number",3,"input"],["matInput","","formControlName","income_other","type","number",3,"input"],["matInput","","formControlName","expenses_rent","type","number",3,"input"],["matInput","","formControlName","expenses_loans","type","number",3,"input"],["matInput","","formControlName","expenses_other","type","number",3,"input"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext",""],["matInput","","formControlName","property_city","type","text",3,"input"],["formControlName","transaction_type",3,"selectionChange"],[3,"value","click",4,"ngFor","ngForOf"],["matInput","","formControlName","estimated_price_by_customer","type","number",3,"input"],["matInput","","formControlName","estimated_price_by_sales_agreement","type","number",3,"input"],["formControlName","has_other_properties",3,"selectionChange"],["matInput","","formControlName","amount_of_loan_requested","type","number",3,"input"],["mat-button","","matStepperNext","",3,"click"],["mat-button","",3,"click"],["style","color: green;",4,"ngFor","ngForOf"],["style","color: red;",4,"ngFor","ngForOf"],[2,"color","green"],[2,"color","red"],[3,"value"],[3,"click","value"]],template:function(m,r){if(m&1){let a=B();i(0,"mat-horizontal-stepper",2,0),f("selectionChange",function(s){return _(a),h(r.onStepChange(s))}),i(2,"mat-step",3)(3,"form",4),c(4,Xe,1,0,"ng-template",5),i(5,"mat-form-field")(6,"mat-label"),u(7,"\u05D0\u05D9\u05DE\u05D9\u05D9\u05DC"),t(),A(8,"input",6),c(9,et,2,0,"mat-error",7)(10,tt,2,0,"mat-error",7),t(),i(11,"mat-form-field")(12,"mat-label"),u(13,"\u05E1\u05D9\u05E1\u05DE\u05D0"),t(),A(14,"input",8),c(15,rt,2,0,"mat-error",7),t(),c(16,ot,6,2,"div",7),i(17,"div")(18,"button",9,1),f("click",function(){return _(a),h(r.checkUserNameAndPassword())}),u(20,"\u05D4\u05D1\u05D0"),t()()()(),i(21,"mat-step",3)(22,"form",4),c(23,ut,1,0,"ng-template",5),i(24,"mat-form-field")(25,"mat-label"),u(26,"\u05E9\u05DD \u05DE\u05E9\u05E4\u05D7\u05D4"),t(),i(27,"input",10),f("input",function(s){return _(a),h(r.onInputChange("last_Name",s))}),t(),c(28,at,2,0,"mat-error",7)(29,st,2,0,"mat-error",7),t(),i(30,"mat-form-field")(31,"mat-label"),u(32,"\u05D7\u05D9\u05D1\u05D5\u05E8"),t(),i(33,"mat-select",11),f("selectionChange",function(s){return _(a),h(r.onSelectionChange("connection",s.value))}),c(34,mt,2,2,"mat-option",12),t()(),i(35,"mat-form-field")(36,"mat-label"),u(37,"\u05EA.\u05D6."),t(),i(38,"input",13),f("input",function(s){return _(a),h(r.onInputChange("t_z",s))}),t(),i(39,"mat-error"),u(40," \u05DE\u05E1\u05E4\u05E8 \u05EA\u05E2\u05D5\u05D3\u05EA \u05D6\u05D4\u05D5\u05EA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF "),t()(),i(41,"mat-form-field")(42,"mat-label"),u(43,"\u05EA\u05D0\u05E8\u05D9\u05DA \u05DC\u05D9\u05D3\u05D4"),t(),i(44,"input",14),f("input",function(s){return _(a),h(r.onInputChange("birthDate",s))}),t(),i(45,"mat-error"),u(46," \u05E0\u05D0 \u05DC\u05D4\u05DB\u05E0\u05D9\u05E1 \u05EA\u05D0\u05E8\u05D9\u05DA \u05EA\u05E7\u05D9\u05DF \u05E2\u05D3 \u05DC\u05EA\u05D0\u05E8\u05D9\u05DA \u05D4\u05E0\u05D5\u05DB\u05D7\u05D9 "),t()(),i(47,"mat-form-field")(48,"mat-label"),u(49,"\u05DE\u05E6\u05D1 \u05DE\u05E9\u05E4\u05D7\u05EA\u05D9"),t(),i(50,"mat-select",15),f("selectionChange",function(s){return _(a),h(r.onSelectionChange("family_status",s.value))}),c(51,lt,2,2,"mat-option",12),t()(),i(52,"mat-form-field")(53,"mat-label"),u(54,"\u05DE\u05E1\u05E4\u05E8 \u05D0\u05E0\u05E9\u05D9\u05DD \u05D1\u05D1\u05D9\u05EA"),t(),i(55,"input",16),f("input",function(s){return _(a),h(r.onInputChange("number_of_people_in_house",s))}),t(),c(56,pt,2,0,"mat-error",7),t(),i(57,"mat-form-field")(58,"mat-label"),u(59,"\u05DB\u05EA\u05D5\u05D1\u05EA"),t(),i(60,"input",17),f("input",function(s){return _(a),h(r.onInputChange("address",s))}),t(),c(61,dt,2,0,"mat-error",7),t(),i(62,"h3"),u(63,"\u05E4\u05E8\u05D8\u05D9 \u05EA\u05E2\u05E1\u05D5\u05E7\u05D4"),t(),i(64,"mat-form-field")(65,"mat-label"),u(66,"\u05E1\u05D8\u05D8\u05D5\u05E1"),t(),i(67,"mat-select",18),f("selectionChange",function(s){return _(a),h(r.onSelectionChange("job_status",s.value))}),c(68,Dt,2,2,"mat-option",12),t()(),i(69,"mat-form-field")(70,"mat-label"),u(71,"\u05DE\u05E7\u05D5\u05DD \u05E2\u05D1\u05D5\u05D3\u05D4"),t(),i(72,"input",19),f("input",function(s){return _(a),h(r.onInputChange("work_business_name",s))}),t(),c(73,ct,2,0,"mat-error",7),t(),i(74,"mat-form-field")(75,"mat-label"),u(76,"\u05EA\u05E4\u05E7\u05D9\u05D3"),t(),i(77,"input",20),f("input",function(s){return _(a),h(r.onInputChange("job_description",s))}),t(),c(78,_t,2,0,"mat-error",7),t(),i(79,"mat-form-field")(80,"mat-label"),u(81,"\u05DE\u05E9\u05DB\u05D5\u05E8\u05EA \u05D7\u05D5\u05D3\u05E9\u05D9\u05EA \u05DE\u05DE\u05D5\u05E6\u05E2\u05EA \u05E0\u05D8\u05D5"),t(),i(82,"input",21),f("input",function(s){return _(a),h(r.onInputChange("avarage_monthly_salary",s))}),t(),c(83,ht,2,0,"mat-error",7),t(),i(84,"mat-form-field")(85,"mat-label"),u(86,"\u05D5\u05EA\u05E7"),t(),i(87,"input",22),f("input",function(s){return _(a),h(r.onInputChange("years_in_current_position",s))}),t(),c(88,ft,2,0,"mat-error",7),t(),i(89,"h3"),u(90,"\u05D4\u05DB\u05E0\u05E1\u05D5\u05EA"),t(),i(91,"mat-form-field")(92,"mat-label"),u(93,"\u05E7\u05E6\u05D1\u05D0\u05D5\u05EA"),t(),i(94,"input",23),f("input",function(s){return _(a),h(r.onInputChange("income_rent",s))}),t(),c(95,Et,2,0,"mat-error",7),t(),i(96,"mat-form-field")(97,"mat-label"),u(98,"\u05DE\u05D6\u05D5\u05E0\u05D5\u05EA"),t(),i(99,"input",24),f("input",function(s){return _(a),h(r.onInputChange("income_Government_Endorsement",s))}),t(),c(100,gt,2,0,"mat-error",7),t(),i(101,"mat-form-field")(102,"mat-label"),u(103,"\u05DE\u05E7\u05D5\u05E8 \u05D0\u05D7\u05E8"),t(),i(104,"input",25),f("input",function(s){return _(a),h(r.onInputChange("income_other",s))}),t(),c(105,St,2,0,"mat-error",7),t(),i(106,"h3"),u(107,"\u05D4\u05D5\u05E6\u05D0\u05D5\u05EA"),t(),i(108,"mat-form-field")(109,"mat-label"),u(110,"\u05E9\u05DB\u05E8 \u05D3\u05D9\u05E8\u05D4"),t(),i(111,"input",26),f("input",function(s){return _(a),h(r.onInputChange("expenses_rent",s))}),t(),c(112,vt,2,0,"mat-error",7),t(),i(113,"mat-form-field")(114,"mat-label"),u(115,"\u05D4\u05DC\u05D5\u05D5\u05D0\u05D5\u05EA"),t(),i(116,"input",27),f("input",function(s){return _(a),h(r.onInputChange("expenses_loans",s))}),t(),c(117,Ct,2,0,"mat-error",7),t(),i(118,"mat-form-field")(119,"mat-label"),u(120,"\u05DE\u05E7\u05D5\u05E8 \u05D0\u05D7\u05E8"),t(),i(121,"input",28),f("input",function(s){return _(a),h(r.onInputChange("expenses_other",s))}),t(),c(122,bt,2,0,"mat-error",7),t(),i(123,"div")(124,"button",29),u(125,"\u05D7\u05D6\u05D5\u05E8"),t(),i(126,"button",30),u(127,"\u05D4\u05D1\u05D0"),t()()()(),i(128,"mat-step",3)(129,"form",4),c(130,yt,1,0,"ng-template",5),i(131,"mat-form-field")(132,"mat-label"),u(133,"\u05D9\u05D9\u05E9\u05D5\u05D1"),t(),i(134,"input",31),f("input",function(s){return _(a),h(r.onInputChange("property_city",s))}),t(),c(135,wt,2,0,"mat-error",7),t(),i(136,"mat-form-field")(137,"mat-label"),u(138,"\u05E1\u05D5\u05D2 \u05E2\u05E1\u05E7\u05D4"),t(),i(139,"mat-select",32),f("selectionChange",function(s){return _(a),h(r.onSelectionChange("transaction_type",s.value))}),c(140,It,2,2,"mat-option",33),t()(),i(141,"mat-form-field")(142,"mat-label"),u(143,"\u05E9\u05D5\u05D5\u05D9 \u05D4\u05E0\u05DB\u05E1 \u05DC\u05E4\u05D9 \u05D4\u05E2\u05E8\u05DB\u05EA \u05DC\u05D5\u05D5\u05D4"),t(),i(144,"input",34),f("input",function(s){return _(a),h(r.onInputChange("estimated_price_by_customer",s))}),t(),c(145,Ft,2,0,"mat-error",7),t(),i(146,"mat-form-field")(147,"mat-label"),u(148,"\u05E9\u05D5\u05D5\u05D4 \u05D4\u05E0\u05DB\u05E1 \u05DC\u05E4\u05D9 \u05D4\u05E1\u05DB\u05DD \u05DE\u05DB\u05E8"),t(),i(149,"input",35),f("input",function(s){return _(a),h(r.onInputChange("estimated_price_by_sales_agreement",s))}),t(),c(150,xt,2,0,"mat-error",7),t(),i(151,"mat-form-field")(152,"mat-label"),u(153,"\u05D9\u05E9 \u05E0\u05DB\u05E1\u05D9\u05DD \u05E0\u05D5\u05E1\u05E4\u05D9\u05DD \u05DC\u05DC\u05D5\u05D5\u05D4"),t(),i(154,"mat-select",36),f("selectionChange",function(s){return _(a),h(r.onSelectionChange("has_other_properties",s.value))}),c(155,Gt,2,2,"mat-option",12),t()(),i(156,"mat-form-field")(157,"mat-label"),u(158,"\u05E1\u05DB\u05D5\u05DD \u05D4\u05D4\u05DC\u05D5\u05D5\u05D0\u05D4"),t(),i(159,"input",37),f("input",function(s){return _(a),h(r.onInputChange("amount_of_loan_requested",s))}),t(),c(160,Nt,2,0,"mat-error",7),t(),i(161,"div")(162,"button",29),u(163,"\u05D7\u05D6\u05D5\u05E8"),t(),i(164,"button",38),f("click",function(){return _(a),h(r.save())}),u(165,"\u05D4\u05D1\u05D0"),t()()()(),i(166,"mat-step",3)(167,"form",4),c(168,Vt,1,0,"ng-template",5),A(169,"documents-list-customer"),i(170,"div")(171,"button",29),u(172,"\u05D7\u05D6\u05D5\u05E8"),t(),i(173,"button",39),f("click",function(){return _(a),h(r.saveDocuments())}),u(174,"\u05E9\u05DE\u05D5\u05E8"),t()()()()()}if(m&2){let a,d,s,y,w,I,S,F,x,G,N,Y,Z,H,K,X,ee,te,re,ie,ne,oe;p("linear",r.isLinear),l(2),p("stepControl",r.firstFormGroup),l(),p("formGroup",r.firstFormGroup),l(6),p("ngIf",(a=r.firstFormGroup.get("userName"))==null?null:a.hasError("required")),l(),p("ngIf",(d=r.firstFormGroup.get("userName"))==null?null:d.hasError("email")),l(5),p("ngIf",(s=r.firstFormGroup.get("password"))==null?null:s.hasError("required")),l(),p("ngIf",(y=r.firstFormGroup.get("password"))==null?null:y.touched),l(2),p("disabled",r.firstFormGroup.invalid),l(3),p("stepControl",r.secondFormGroup),l(),p("formGroup",r.secondFormGroup),l(6),p("ngIf",(w=r.secondFormGroup.get("last_Name"))==null?null:w.hasError("required")),l(),p("ngIf",(I=r.secondFormGroup.get("last_Name"))==null?null:I.hasError("pattern")),l(5),p("ngForOf",r.connectionOptions),l(17),p("ngForOf",r.familyStatusOptions),l(5),p("ngIf",(S=r.secondFormGroup.get("number_of_people_in_house"))==null?null:S.hasError("required")),l(5),p("ngIf",(F=r.secondFormGroup.get("address"))==null?null:F.hasError("required")),l(7),p("ngForOf",r.jobStatusOptions),l(5),p("ngIf",(x=r.secondFormGroup.get("work_business_name"))==null?null:x.hasError("required")),l(5),p("ngIf",(G=r.secondFormGroup.get("job_description"))==null?null:G.hasError("required")),l(5),p("ngIf",(N=r.secondFormGroup.get("avarage_monthly_salary"))==null?null:N.hasError("required")),l(5),p("ngIf",(Y=r.secondFormGroup.get("years_in_current_position"))==null?null:Y.hasError("required")),l(7),p("ngIf",(Z=r.secondFormGroup.get("income_rent"))==null?null:Z.hasError("required")),l(5),p("ngIf",(H=r.secondFormGroup.get("income_Government_Endorsement"))==null?null:H.hasError("required")),l(5),p("ngIf",(K=r.secondFormGroup.get("income_other"))==null?null:K.hasError("required")),l(7),p("ngIf",(X=r.secondFormGroup.get("expenses_rent"))==null?null:X.hasError("required")),l(5),p("ngIf",(ee=r.secondFormGroup.get("expenses_loans"))==null?null:ee.hasError("required")),l(5),p("ngIf",(te=r.secondFormGroup.get("expenses_other"))==null?null:te.hasError("required")),l(6),p("stepControl",r.thirdFormGroup),l(),p("formGroup",r.thirdFormGroup),l(6),p("ngIf",(re=r.thirdFormGroup.get("property_city"))==null?null:re.hasError("required")),l(5),p("ngForOf",r.transactiontypeOptions),l(5),p("ngIf",(ie=r.thirdFormGroup.get("estimated_price_by_customer"))==null?null:ie.hasError("required")),l(5),p("ngIf",(ne=r.thirdFormGroup.get("estimated_price_by_sales_agreement"))==null?null:ne.hasError("required")),l(5),p("ngForOf",r.hasOtherProperties),l(5),p("ngIf",(oe=r.thirdFormGroup.get("amount_of_loan_requested"))==null?null:oe.hasError("required")),l(6),p("stepControl",r.fourthFormGroup),l(),p("formGroup",r.fourthFormGroup)}},dependencies:[le,pe,ce,Ne,xe,Ge,Ve,Fe,Te,Oe,Ae,qe,ke,Le,_e,Se,he,ve,fe,Ee,ye,Ce,be,Ue],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}button[_ngcontent-%COMP%]{margin-right:8px}h3[_ngcontent-%COMP%]{margin-top:20px}.invalid-requirement[_ngcontent-%COMP%]{color:red}.valid-requirement[_ngcontent-%COMP%]{color:green}mat-horizontal-stepper[_ngcontent-%COMP%]{width:50vw;margin:0 auto}#content[_ngcontent-%COMP%]{background-color:#ffffff9a;padding:25px;border-radius:40px;min-width:max-content;min-height:60vh}"]});let e=o;return e})();var We=(()=>{let o=class o{constructor(n,m,r){this.route=n,this.leadService=m,this.router=r,this.id=null,this.token=null,this.isNotValid=!1}ngOnInit(){console.log("in ngooninit of magic link"),this.route.queryParams.subscribe(n=>{this.id=n.id,this.token=n.token,console.log("ID:",this.id),console.log("Token:",this.token)}),this.id!=null&&this.leadService.checkToken(this.id).subscribe(n=>{n.status===200?this.router.navigate(["lead/lead",this?.id]):this.isNotValid=!0},n=>{console.error("Error checking token:",n),this.isNotValid=!0})}};o.\u0275fac=function(m){return new(m||o)(g(q),g(k),g(De))},o.\u0275cmp=O({type:o,selectors:[["app-magic-link"]],decls:2,vars:0,template:function(m,r){m&1&&(i(0,"p"),u(1,"magic-link works!"),t())}});let e=o;return e})();var Lt=[{path:"",component:W},{path:"lead/:id",component:W},{path:"magic-link",component:We}],Ye=(()=>{let o=class o{};o.\u0275fac=function(m){return new(m||o)},o.\u0275mod=T({type:o}),o.\u0275inj=L({imports:[R.forChild(Lt),R]});let e=o;return e})();var Lr=(()=>{let o=class o{};o.\u0275fac=function(m){return new(m||o)},o.\u0275mod=T({type:o}),o.\u0275inj=L({imports:[de,Me,Ie,Ye,ze]});let e=o;return e})();export{Lr as a};
