<main>
  @if(dataSource.data.length>0){
  <div dir="rtl">
    <mat-form-field>
      <mat-label>חפש</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="" #input />
    </mat-form-field>
  </div>

  <div>
    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z8"
      dir="rtl"
    >
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef><b> שם מסמך </b></th>
        <td mat-cell *matCellDef="let element">
          {{ element.task_description }}
        </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef><b> סוג עסקה </b></th>
        <td mat-cell *matCellDef="let element">
          {{ changeTransacTypeToString(element.document_type_id) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef><b> סטטוס </b></th>
        <td mat-cell *matCellDef="let element">
          {{ changeDocStatusToString(element.status) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="icon">
        <th mat-header-cell *matHeaderCellDef><b> מסמך </b></th>
        <td mat-cell *matCellDef="let element; let i = index">
          @if(element.status==0){
          <button
            class="icon-button attach"
            mat-icon-button
            aria-label="upload file"
            (click)="fileInput.click()"
            matTooltip="צירוף מסמך"
            matTooltipPosition="left"
          >
            <mat-icon class="icon">attach_file</mat-icon>
            <input
              type="file"
              #fileInput
              (change)="onFileSelected($event, element)"
              style="display: none"
            />
          </button>
          } @if (element.status==1) {
          <span
            (click)="viewDocument(view(element.id))"
            style="cursor: pointer"
            class="span"
          >
          {{ element.document_path }}
          </span>

          <button mat-button (click)="cancelDocument(element)">ביטול</button>
          } @if (element.status==2) {
          {{ element.document_path }}
          <button mat-button (click)="download(element)">
            לחץ כאן להורדה
          </button>
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef><b> תאריך עדכון </b></th>
        <td mat-cell *matCellDef="let element">
          @if(element.status==2){
          {{ formatDate(element.updated_at) }}
          }
        </td>
      </ng-container>
      <ng-container matColumnDef="approval">
        <th mat-header-cell *matHeaderCellDef><b> אישור פעולה </b></th>
        <td mat-cell *matCellDef="let element">
          @if (element.status === 1) {
          <section class="example-section">
            <mat-checkbox
              #myCheckbox
              id="mat-checkbox"
              (change)="onCheckboxChange($event.checked, element)"
              class="example-margin"
              [disabled]="element.status !== 1"
            ></mat-checkbox>
          </section>
          } @else if(element.status===0){
          <mat-checkbox
            #myCheckbox
            id="mat-checkbox"
            (change)="onCheckboxChange($event.checked, element)"
            class="example-margin"
            [disabled]="true"
          ></mat-checkbox>
          }
          @else {
            <mat-icon class="icon">check</mat-icon>
          }
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
  <div class="send-all">
    <div class="example-button-row">
      <button mat-raised-button (click)="saveFiles()">
        <span class="button-text">שלח מסמכים</span>
        <span class="icon-container"
          ><i class="fa-solid fa-paper-plane"></i
        ></span>
      </button>
    </div>
  </div>

  } @else {
  <div class="centered-message">לא נמצאו עבורך מסמכים</div>
  }
</main>
